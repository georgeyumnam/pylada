

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setting up MPI &mdash; LaDa 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="LaDa 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Compiling, installing, and setup" href="../installation.html" />
    <link rel="next" title="Setting up the PBS/Slurm ressources" href="ressources.html" />
    <link rel="prev" title="Compiling, installing, and setup" href="../installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ressources.html" title="Setting up the PBS/Slurm ressources"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Compiling, installing, and setup"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">LaDa 1.0 documentation</a> &raquo;</li>
          <li><a href="../../userguide.html" >User Guide</a> &raquo;</li>
          <li><a href="../installation.html" accesskey="U">Compiling, installing, and setup</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="setting-up-mpi">
<span id="install-mpi-ug"></span><h1>Setting up MPI<a class="headerlink" href="#setting-up-mpi" title="Permalink to this headline">¶</a></h1>
<div class="section" id="single-call-to-mpi-program">
<h2>single call to mpi program<a class="headerlink" href="#single-call-to-mpi-program" title="Permalink to this headline">¶</a></h2>
<p>The command-line for mpi executables is stored in <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">lada.mpirun_exe</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># openmpi and friends</span>
<span class="n">mpirun_exe</span> <span class="o">=</span> <span class="s">&quot;mpirun -n {n} {placement} {program}&quot;</span>
<span class="c"># Crays</span>
<span class="n">mpirun_exe</span> <span class="o">=</span> <span class="s">&quot;aprun -n {n} {placement} {program}&quot;</span>
</pre></div>
</div>
<p>This is a <a class="reference external" href="http://docs.python.org/library/stdtypes.html#str.format">format string</a>. It can take any number of arguments. However, two
are required: &#8220;n&#8221;, which is the number of processes, and &#8220;program&#8221;, which is
the commandline for the program to launch. The latter will be manufactured by
LaDa internally. It is a placeholder at this point. The other reseverved
keyword is &#8220;ppn&#8221;, the number of processes per node. It should only be used for
that purpose.</p>
<p>The keywords in <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">lada.mpirun_exe</span></tt></a> should be defined in
<a class="reference internal" href="../config.html#lada.default_comm" title="lada.default_comm"><tt class="xref py py-data docutils literal"><span class="pre">lada.default_comm</span></tt></a>. This is a dictionary which holds default values
for the different keywords. The dictionary may hold more keywords than are
present in <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">lada.mpirun_exe</span></tt></a>. The converse is not true.</p>
</div>
<div class="section" id="multiple-mpi-programs-in-parallel">
<span id="install-mmpi-ug"></span><h2>multiple mpi programs in parallel<a class="headerlink" href="#multiple-mpi-programs-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>It can be adavantageous to make simultaneous calls to different mpi programs or
the different calculations using the same mpi program. For instance, in a
genetic algorithm search, many different individuals need to be evaluated. It
would be best to do this in parallel and asynchronically. LaDa does provide for
this ability. However, setting it up can be difficult. The trick is to make
sure that LaDa knows which nodes it is allowed to run on each time it is
launched within a PBS or SLURM script.</p>
<p>LaDa figures out which nodes it can run on by launching at the start of the
calculation a small mpi program with all the allocated nodes, using
directive defined by <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">mpirun_exe</span></tt></a>. This small program merely
calls <a class="reference external" href="http://docs.python.org/library/socket.html#socket.gethostname">socket.gethostname</a> from each process. This way, it figures out the
nodes, and how many procs should be placed on each note. Later on, the
&#8220;{placement}&#8221; option in <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">mpirun_exe</span></tt></a> is used to specify where to
run each executable.</p>
<p>Lets figure out the different steps to setting this up. The easiest way to
figure out the value of a specific configuration variable is start an ipython
session and simply check what it is in the root <tt class="xref py py-mod docutils literal"><span class="pre">lada</span></tt> package.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Check that <a class="reference internal" href="../config.html#lada.do_multiple_mpi_programs" title="lada.do_multiple_mpi_programs"><tt class="xref py py-data docutils literal"><span class="pre">do_multiple_mpi_programs</span></tt></a> is set to &#8216;&#8217;True&#8217;&#8216;</li>
<li>Check <a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">mpirun_exe</span></tt></a> makes sense. Make sure that you
have &#8220;{placement}&#8221; in this string (see step 4).</li>
<li>Check <a class="reference internal" href="../config.html#lada.figure_out_machines" title="lada.figure_out_machines"><tt class="xref py py-data docutils literal"><span class="pre">figure_out_machines</span></tt></a> and make sure that it will work
with your installation. By default, it requires that <a class="reference external" href="http://www.boost.org/doc/libs/1_49_0/doc/html/mpi.html">boost.mpi</a> and its
<a class="reference external" href="http://www.boost.org/doc/libs/1_49_0/doc/html/mpi/python.html">boost.python</a> bindings be installed. It should be fairly simple to change
it to some other mpi python-bindings.</li>
<li>If you are not using a standard mpich-like library (e.g. Cray crap), you
will have to modify <a class="reference internal" href="../config.html#lada.modify_global_comm" title="lada.modify_global_comm"><tt class="xref py py-func docutils literal"><span class="pre">modify_global_comm()</span></tt></a> to suit your
needs. Good luck with that machine.</li>
<li>Check that <a class="reference internal" href="../config.html#lada.placement" title="lada.placement"><tt class="xref py py-func docutils literal"><span class="pre">placement()</span></tt></a> makes sense. This is a function
which takes a <tt class="xref py py-class docutils literal"><span class="pre">Communicator</span></tt> instance and returns a
string which will be substituted for &#8220;{placement}&#8221; in
<a class="reference internal" href="../config.html#lada.mpirun_exe" title="lada.mpirun_exe"><tt class="xref py py-data docutils literal"><span class="pre">mpirun_exe</span></tt></a>. By default, it returns a path to a temporary
<a class="reference external" href="https://www.google.co.uk/search?q=mpi+machine+files">file listing the machines</a> to use. This should work on any supercomputer
with a standard mpi installation. A communicator is a standard python
dictionary with an additional
<tt class="xref py py-attr docutils literal"><span class="pre">machines</span></tt> attribute. For standard
mpi installations, you will only need to make sure that the correct option
is used to specify a machine file (generally, &#8216;-machinefile&#8217;).</li>
<li>Check <a class="reference internal" href="../config.html#lada.pbs_string" title="lada.pbs_string"><tt class="xref py py-data docutils literal"><span class="pre">pbs_string</span></tt></a></li>
</ol>
</div></blockquote>
<p>Often time, you will only need to go through steps 1 and 2, and install the
<a class="reference external" href="http://www.boost.org/doc/libs/1_49_0/doc/html/mpi.html">boost.mpi</a> <a class="reference external" href="boost.python">python bindings</a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setting up MPI</a><ul>
<li><a class="reference internal" href="#single-call-to-mpi-program">single call to mpi program</a></li>
<li><a class="reference internal" href="#multiple-mpi-programs-in-parallel">multiple mpi programs in parallel</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../installation.html"
                        title="previous chapter">Compiling, installing, and setup</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ressources.html"
                        title="next chapter">Setting up the PBS/Slurm ressources</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/userguide/installation/mpi.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ressources.html" title="Setting up the PBS/Slurm ressources"
             >next</a> |</li>
        <li class="right" >
          <a href="../installation.html" title="Compiling, installing, and setup"
             >previous</a> |</li>
        <li><a href="../../index.html">LaDa 1.0 documentation</a> &raquo;</li>
          <li><a href="../../userguide.html" >User Guide</a> &raquo;</li>
          <li><a href="../installation.html" >Compiling, installing, and setup</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Mayeul d&#39;Avezac.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>